<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="description" content="Askbootstrap" />
<meta name="author" content="Askbootstrap" />
<title>FU Market - Online Food Ordering </title>
<!-- Favicon Icon -->
<link href="skin/css/styles.css" rel="stylesheet" />
    <!-- Favicon Icon -->
    <link rel="icon" type="image/png" href="image/favicon.png">
    <!-- Bootstrap core CSS-->
    <link href="skin/bootstrap/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome-->
    <link href="skin/font/all.min.css" rel="stylesheet">
    <!-- Font Awesome-->
    <link href="skin/font/icofont.min.css" rel="stylesheet">
    <!-- Select2 CSS-->
    <link href="skin/font/select2.min.css" rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="skin/font/osahan.css" rel="stylesheet">
    <!-- Dropzone-->
    <link href="skin/font/dropzone.css" rel="stylesheet">
    <!-- HungCSS -->
    <link href="skin/font/HungCSS.css" rel="stylesheet">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="skin/owl/owl.carousel.css">
    <link rel="stylesheet" href="skin/owl/owl.theme.css">

    <link href="skin/font/DoanCSS.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        .switch {
         position: relative;
         display: inline-block;
         width: 60px;
         height: 34px;
      }

      .switch input {
         opacity: 0;
         width: 0;
         height: 0;
      }

      .slider {
         position: absolute;
         cursor: pointer;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background-color: #ccc;
         -webkit-transition: .4s;
         transition: .4s;
      }

      .slider:before {
         position: absolute;
         content: "";
         height: 26px;
         width: 26px;
         left: 4px;
         bottom: 4px;
         background-color: white;
         -webkit-transition: .4s;
         transition: .4s;
      }

      input:checked+.slider {
         background-color: #2196F3;
      }

      input:focus+.slider {
         box-shadow: 0 0 1px #2196F3;
      }

      input:checked+.slider:before {
         -webkit-transform: translateX(26px);
         -ms-transform: translateX(26px);
         transform: translateX(26px);
      }

      /* Rounded sliders */
      .slider.round {
         border-radius: 34px;
      }

      .slider.round:before {
         border-radius: 50%;
      }
    </style>
</head>
<body class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-light bg-white shadow-sm">
    <a class="navbar-brand" href="listOrderSeller"><img alt="logo" src="image/image0.jpg" width="100px"></a>
    <!-- Navbar Search-->
    <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
        <div class="input-group">
            <div class="input-group-append">
                <label id="statusShop" class="mr-2"></label>
                <label class="switch">
                <input type="checkbox" id="switchShop" name="swiShop">
                <span class="slider round"></span>
                </label>
            </div>
        </div>
    </form>
    <!-- Navbar-->
    <ul class="navbar-nav ml-auto ml-md-0">
        <li class="nav-item dropdown no-arrow d-sm-none">
            <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-search"></i>
            </a>
            <!-- Dropdown - Messages -->
            <div class="dropdown-menu dropdown-menu-right p-3 shadow-sm animated--grow-in" aria-labelledby="searchDropdown">
                <form class="form-inline mr-auto w-100 navbar-search">
                <div class="input-group">
                    <input type="text" class="form-control border-0 shadow-none" placeholder="Search people, jobs and more..." aria-label="Search" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                        <button class="btn" type="button">
                        <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                </form>
            </div>
        </li>
        
        
        <!-- Nav Item - User Information -->
        <li id="checkLogin"></li>
        <li class="nav-item dropdown" id="nameSeller"></li>
    </ul>
    </nav>
    <div id="layoutSidenav">
    <div id="layoutSidenav_nav">
        <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
            <div class="sb-sidenav-menu">
                <div class="nav">
                    <div class="sb-sidenav-menu-heading">Danh Mục</div>

                    <a class="nav-link" href="listOrderSeller">
                    <div class="sb-nav-link-icon"><i class="fas fa-cart-arrow-down"></i></div>
                    Danh Sách Đặt hàng <span class="badge badge-pill ml-2 badge-primary"></span>
                    </a>
                    <a class="nav-link" href="listShipForSeller">
                    <div class="sb-nav-link-icon"><i class="fas fa-shipping-fast"></i></div>
                    Danh Sách Giao Hàng <span class="badge badge-pill ml-2 badge-primary"></span>
                </a>
                    <a class="nav-link" href="ListAcceptBill">
                    <div class="sb-nav-link-icon"><i class="fas fa-check-circle"></i></div>
                    Danh Sách Đơn Hoàn Thành
                    </a>
                
                    <a class="nav-link" href="ListDeleteBill">
                    <div class="sb-nav-link-icon"><i class="fas fa-trash-alt"></i></div>
                    Danh Sách Đơn Hủy
                    </a>
                    <a class="nav-link" href="listProductSeller">
                    <div class="sb-nav-link-icon"><i class="fas fa-boxes"></i></div>
                    Quản Lý Sản Phẩm
                    </a>
                    <a class="nav-link" href="ListReportBySeller">
                    <div class="sb-nav-link-icon"><i class="fas fa-file-signature"></i></div>
                    Dánh sách Báo Cáo
                    </a>
                </div>
            </div>
        </nav>
        </div>
    <div id="layoutSidenav_content">
        <main>
        <div class="container-fluid">
            <h1 class="mt-4">Thông Tin Cá Nhân </h1>    
            <div class="row">
                <div class="col-xl-12">
                    <div class="card mb-4 order-list">
                   
                        <div class="osahan-account-page-right shadow-sm bg-white p-4 h-100">
                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="myPro" role="tabpanel" aria-labelledby="profile-tab">
                                   
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="osahan-user text-center">
                                                <div class="osahan-user-media">
                                                    <div class="picture-container">
                                                        <div class="picture">
                                                            <img class="picture-src" id="wizardPicturePreview">
                                                            <input type="file" class="form-control" id="wizard-picture" name="uploadfile" accept="image/png, image/jpeg"></input>
                                                        </div>
                                                        <h6 class="text">Chọn ảnh</h6>
                                                    </div>
        
                                                    <input type="button" value="Lưu thay đổi" id="changeImage" class="btn btn-success"></input>
                                                    <div class="osahan-user-media-body"> </div>
                                                </div>
                                            </div>
                                        </div>
        
                                        <div class="col-md-8 add_top_30">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Tên</label>
                                                        <input type="text" class="form-control" id="name" placeholder="Tên của bạn">
                                                        <span class="form-message text-danger" id="messageName"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Ngày-tháng-năm sinh</label>
                                                        <input type="date" id="date" class="form-control">
                                                        <span class="form-message text-danger" id="messageDate"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- /row-->
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Số điện thoại</label>
                                                        <input type="text" class="form-control" id="phone" placeholder="Số điện thoại">
                                                        <span class="form-message text-danger" id="messagePhone"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Email</label>
                                                        <input type="email" class="form-control" id="email" placeholder="Email" disabled>
                                                        <span class="form-message text-danger" id="messageEmail"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- /row-->
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label> Địa chỉ </label>
                                                        <textarea style="height:70px;" class="form-control" id="address" placeholder="Địa chỉ"></textarea>
                                                        <span class="form-message text-danger" id="messageAddress"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="save col-md-12">
                                                    <input type="button" value="Lưu" id="SaveUpdate" class="btn btn-success"></input>
                                                    <input type="button" value="Đổi mật khẩu" id="SaveUpdatePassWord" data-toggle="modal" data-target="#basicModal" class="btn btn-secondary ml-3">
                                                    </input>
                                                </div>
                                                <!-- Save New password -->
                                                <div class="modal fade" id="basicModal" role="dialog">
                                                    <div class="modal-dialog">
                                                        <div class="modal-dialog">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h6 class="m-0"><i class="fa fa-lock text-muted mr-2"></i>Đổi mật khẩu
                                                                        </h6>
                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">×</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div class="form-group">
                                                                            <label>Mật khẩu cũ</label>
                                                                            <input class="form-control" id="Old_password" type="password">
                                                                            <span class="form-message text-danger" id="oldpassword"></span>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label>Mật khẩu mới</label>
                                                                            <input class="form-control" id="New_password" type="password">
                                                                            <span class="form-message text-danger" id="newpassword"></span>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label>Nhập lại mật khẩu</label>
                                                                            <input class="form-control" id="Confirm_new_password" type="password">
                                                                            <span class="form-message text-danger" id="confirmpassword"></span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <input type="button" value="Đóng" class="btn btn-light" data-dismiss="modal"> </input>
                                                                        <input type="button" value="Lưu thay đổi" id="change" class="btn btn-success"></input>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- /row-->
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                    <h4 class="font-weight-bold mt-0 mb-4"> Lịch sử mua hàng </h4>
                                    <div class="row">
                                        <div class="col-xl-12">
                                            <div>
        
                                                <div class="card-body">
        
                                                    <div class="container show-bill">
        
                                                    </div>
        
        
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="favourites" role="tabpanel" aria-labelledby="favourites-tab">
                                    <h4 class="font-weight-bold mt-0 mb-4">Yêu thích</h4>
                                    <div class="row" id="loadFavouries">
        
                                    </div>
                                </div>
                            </div>
        
                        </div>
                   
                    </div>
                    
                </div>
            </div>
        </main>
        <footer class="py-4 bg-light mt-auto">
        <div class="container-fluid">
        <div class="d-flex align-items-center justify-content-between small">
        <div class="text-muted">Copyright &copy; Your Website 2020</div>
        <div>
        <a href="#">Privacy Policy</a>
        &middot;
        <a href="#">Terms &amp; Conditions</a>
        </div>
        </div>
        </div>
        </footer>
        </div>
    </div>
   <!-- Jquery -->
   <script src="js/jquery.min.js"></script>
   <!-- Fontawesome -->
   <script src="js/all.min.js"></script>
   <!-- Bootstrap -->
   <script src="js/bootstrap.bundle.min.js"></script>
   <!-- Custom Js -->
   <!-- <script src="js/scripts.js"></script> -->
   <!-- Ajax Chart Js -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
   <!-- Chart Js -->
   <!-- <script src="js/chart-area-demo.js"></script>
   <script src="js/chart-bar-demo.js"></script>
   <script src="js/chart-pie-demo.js"></script> -->
   <!-- Datatable Js -->
   <script src="js/jquery.dataTables.min.js"></script>
   <script src="js/dataTables.bootstrap.min.js"></script>
   <script src="js/datatables-demo.js"></script>
   <script src="js/headerSeller.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>


    <script>

        $(document).ready(function() {

            if (token == '') {
                window.location.href = "/404";
            }

            // Prepare the preview for profile picture
            $("#wizard-picture").change(function() {
                readURL(this);
            });
        });

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function(e) {
                    $('#wizardPicturePreview').attr('src', e.target.result).fadeIn('slow');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        $('#changeImage').click(function(e) {
            var data = document.getElementById("wizard-picture").files;
            var formdData = new FormData();
            formdData.append("file", data[0])
            var text = localStorage.getItem('sellerId').replaceAll('"', '');
            formdData.append("id", text)



            $.ajax({
                url: '/api/user/avatar',
                method: 'POST',
                // dataType : 'json',
                data: formdData,
                processData: false,
                contentType: false
            }).then(function(data) {
                if (data.message == 'SUCCESS') {
                    Swal.fire({
                        type: 'success',
                        title: 'Đã thay đổi ảnh ⚙️',
                        // text: 'Your offer is safe 🙂',
                        showConfirmButton: false,
                        timer: 2000
                    })
                } else {
                    Swal.fire({
                        type: 'error',
                        title: 'thay ảnh lỗi ⚙️',
                        // text: 'Your offer is safe 🙂',
                        showConfirmButton: false,
                        timer: 2000
                    })
                }
            })
        });

        var regPhone = /(84|0[3|5|7|8|9])+([0-9]{8})\b/i;

        function CheckUpdateProfile() {

            var userName = document.getElementById('name').value.trim();
            // var password = document.getElementById('password').value.trim();
            var email = document.getElementById('email').value.trim();
            var address = document.getElementById('address').value.trim();
            var date = document.getElementById('date').value.trim();
            var phone = document.getElementById('phone').value.trim();
            var Old_password = document.getElementById('Old_password').value.trim();
            var New_password = document.getElementById('New_password').value.trim();
            var Confirm_new_password = document.getElementById('Confirm_new_password').value.trim();
            // var old_phone = document.getElementById('old_phoneNumber').value.trim();
            // var new_phone = document.getElementById('new_phoneNumber').value.trim();

            if (userName == "") {
                document.getElementById('name').setAttribute('class', 'form-control border-danger');
                document.getElementById('messageName').innerHTML = 'Tên không được để trống';
            } else {
                document.getElementById('name').setAttribute('class', 'form-control');
                document.getElementById('messageName').innerHTML = '';
            }

            if (date == "") {
                document.getElementById('date').setAttribute('class', 'form-control border-danger');
                document.getElementById('messageDate').innerHTML = 'Bạn chưa chọn ngày-tháng-năm sinh';
            } else {
                document.getElementById('date').setAttribute('class', 'form-control');
                document.getElementById('messageDate').innerHTML = '';
            }

            if (regPhone.test(phone) == false) {
                document.getElementById('phone').setAttribute('class', 'form-control border-danger');
                document.getElementById('messagePhone').innerHTML = 'Số điện thoại phải 10 chữ số và đầu số phải 0 hoặc 84';
            } else {
                document.getElementById('phone').setAttribute('class', 'form-control');
                document.getElementById('messagePhone').innerHTML = '';
            }

            if (address == "") {
                document.getElementById('address').setAttribute('class', 'form-control border-danger');
                document.getElementById('messageAddress').innerHTML = 'Địa chỉ không được để trống';
            } else {
                document.getElementById('address').setAttribute('class', 'form-control');
                document.getElementById('messageAddress').innerHTML = '';
            }


        }

        $(document).ready(function() {
            loadDataProfile();
            
        });
        function loadDataProfile() {

            var text = localStorage.getItem('sellerId').replaceAll('"', '');

            $.ajax({
                type: "GET",
                dataType: "json",
                data: {
                    id: text
                },
                url: "/api/user/getbyId",
                success: function(data) {
                    
                    var list = data.data;
                    document.getElementById('name').value = list.name;
                    document.getElementById('phone').value = list.phone;
                    document.getElementById('email').value = list.email;
                    document.getElementById('address').value = list.address;
                    var d = new Date(list.dob);
                    var n;
                    if (d.getUTCDate() < 10) {
                        n = '0' + d.getUTCDate();
                    } else {
                        n = d.getUTCDate();
                    }

                    var m;
                    if (d.getUTCMonth() < 10) {
                        m = '0' + d.getUTCMonth();
                    } else {
                        m = d.getUTCMonth();
                    }

                    var y = d.getUTCFullYear();

                    var dob = y + '-' + m + '-' + n;
                    document.getElementById('date').value = dob;
                    document.getElementById('wizardPicturePreview').src = list.avatar;
                }
            });
        }

        $("#SaveUpdate").click(function() {

            var userId = localStorage.getItem('sellerId').replaceAll('"', '');

            CheckUpdateProfile();
            $.ajax({
                url: "/api/user/updateUser",
                type: "POST",
                data: {
                    id: userId,
                    name: $('#name').val().trim(),
                    email: $('#email').val().trim(),
                    address: $('#address').val().trim(),
                    phone: $('#phone').val().trim(),
                    dob: $('#date').val().trim()
                }
            }).then(function(data) {
                if (data.message == "SUCCESS") {
                    Swal.fire({
                        type: 'success',
                        title: 'Lưu thay đổi ⚙️',
                        // text: 'Your offer is safe 🙂',
                        showConfirmButton: false,
                        timer: 2000
                    })
                    loadDataProfile();
                    loadName();
                }
            })
        })

        $("#change").click(function() {
            var userId = localStorage.getItem('userId').replaceAll('"', '');
            
            $.ajax({
                url: "/api/user/changePass",
                type: "POST",
                data: {
                    userId: userId,
                    password: $("#Confirm_new_password").val().trim()
                }
            }).then(function(data) {
                
                if (data.message == "SUCCESS") {
                    Swal.fire({
                        type: 'success',
                        title: 'Lưu thay đổi ⚙️',
                        // text: 'Your offer is safe 🙂',
                        showConfirmButton: false,
                        timer: 2000
                    })
                }
            })
        })

    </script>
</body>
</html>